<!DOCTYPE html>
<html>
<body onload="read('onLoad')">
<div id="panel0">
    <img id="panel1" src="0.png">
    <select id="avatarSelector">
        <option id="selectLabel">CHOOSE</option>
        <option id="CAT" value="CAT">LOADING</option>
        <option id="DOG" value="DOG">LOADING</option>
    </select>
    <button id="panel2" onclick="newAvatar()">NEW ANIMALE</button>
    <button id="panel3" onclick="login()">FIND MY ANIMAL</button>
</div>
<div>
    <button id="home" onclick="back()">BACK</button>
    <button id="actionButton" onclick="action()">&#x2060</button>
    <button id="avatar">&#x2060</button>
</div>
<div>
    <button style="background: url(0.png)" id="1" onclick="navigate('1')">Town</button>
    <button style="background: url(0.png)" id="2" onclick="navigate('2')">Mountain</button>
    <button style="background: url(0.png)" id="3" onclick="navigate('3')">Sea</button>
</div>
<div>
    <button style="background: url(0.png)" id="4" onclick="navigate('4')">Desert</button>
    <button style="background: url(0.png)" id="5" onclick="navigate('5')">Swamp</button>
    <button style="background: url(0.png)" id="6" onclick="navigate('6')">&#x2060</button>
</div>
<div>
    <button style="background: url(0.png)" id="7" onclick="navigate('7')">&#x2060</button>
    <button style="background: url(0.png)" id="8" onclick="navigate('8')">&#x2060</button>
    <button style="background: url(0.png)" id="9" onclick="navigate('9')">&#x2060</button>
</div>
</body>
</html>
<script>
var url = "https://script.google.com/macros/s/AKfycbz62Jx0ltf7VPmCfnvHHwyyAABqcVJnTVcNqO6Wv68b7mMGQ7_NJTF4P6MPZIbjkMJrWQ/exec"
var locations = [
    ["Tree", "Bush", "Stump", "Nest", "Spider Web", "Creek"],
    ["House", "Street","Lamp","Town Hall", "Store", "Library"],
    ["Summit", "Cave", "Waterfall", "Ravine", "Mine", "Bridge"],
    ["Boat", "Dock", "Beach", "Fish Market", "Surf Shack", "Coral Reef"],
    ["Catus", "Dune", "Tomb", "Canyon", "Oasis", "Tumble Weed"],
    ["Hut", "Outhouse", "Dam", "Mud", "Mangrove", "Stink Hole"]
]
var names = ["CAT", "DOG"]
var avatarLocations = [0,0]
var level = 0
var locationId = [0,0]
var canHide = false

function newAvatar() {
    var id = document.querySelector('#avatarSelector').selectedIndex
    document.getElementById("avatar").innerHTML = names[id]
    document.getElemengById("avatarSelector").style.display = "none"
    for(let i = 0; i < 3; i++) {
        document.getElemengById("panel" + i).style.display = "none"
    }
}

function login() {
    document.getElemengById("panel").style.display = "none"
}

function navigate(choice) {
    if(level == 0) {
        changeLevel(1, choice)
    } else if(level == 1) {
        checkSpot(choice)
    }
}

function changeLevel(destination, choice) {
    locationId[0] = choice
    for(let i = 1; i <= 9; i++) {
        document.getElementById(i).innerHTML = locations[choice][1]
    }
    level = 1
}

function checkSpot(choice) {
    canHide = true
    locationId[1] = choice
    for(let i = 1; i <= 9; i++) {
        document.getElementById(i).innerHTML = "\u2060"
    }
    var isEmpty = true
    var hiding
    for(let i = 0; i < avatarLocations.length; i++) {
        if(avatarLocations[i].toString() == locationString()) {
            document.getElementById(names[i]).innerHTML = names[i]
            isEmpty = false
            hiding = names[i]
        }
    }
    if(isEmpty) {
        document.getElementById(num).innerHTML = "NOTHING HERE"
    } else {
        document.getElementById(num).innerHTML = hiding + " FOUND!!"
    }
    level = 2
}

function action() {
    if(canHide) {
        var id = document.querySelector('#avatarSelector').selectedIndex
        if(level == 2) {
            write(locationString(), id-1)
            document.getElementById("hideButton").innerHTML = "HIDING"
        }
    }
}

function back() {
    if(level != 0) {
        location.reload()
    }
}

function onLoad(data) {
    for(let i = 0; i < avatarLocations.length; i++) {
        avatarLocations[i] = data.data[i].Users
        if(avatarLocations[i] == 0) {
            document.getElementById(names[i]).innerHTML = names[i]
        } else {
            document.getElementById(names[i]).innerHTML = "HIDDEN"
        }
    }
}

function read(id) {
    return fetch(url + "?path=Sheet1&action=read")
    .then(res => res.json())
    .then(data => readManager(data, id))
}

function write(location, id) {
    fetch(url + "?path=Sheet1&action=update&Users=" + location + "&number=" + (id + 2))
}

function readManager(data, id) {
    switch(id) {
        case "onLoad":
            onLoad(data)
            break
    }
}

function locationString() {
    return locationId[0].toString() + locationId[1].toString()
}

</script>
<style>
    button, select {
        height: 128px;
        width: 128px;
        border: none;
    }
    div {
        height: 128px;
        width: 384px;
        font-size: 0px;
    }
    .panel {
        position: absolute;
    }
</style>