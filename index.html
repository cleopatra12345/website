<!DOCTYPE html>
<html>
<body onload="read('onLoad')">
<div id="phase1" class="panel">
    <button>&#x2060</button>
    <button onclick="newAvatar()">NEW ANIMALE</button>
    <button onclick="login()">FIND AN ANIMAL</button>
</div>
<div id="phase2" class="panel">
    <button onclick="location.reload()">BACK</button>
    <select id="avatarSelector">
        <option id="selectLabel">CHOOSE</option>
        <option id="CAT" value="CAT">LOADING</option>
        <option id="DOG" value="DOG">LOADING</option>
    </select>
    <button onclick="start()">START</button>
</div>
<div id="phase3">
<div class="panel">
    <button id="home" onclick="back()">BACK</button>
    <button id="actionButton" onclick="action()">&#x2060</button>
    <button id="avatar">&#x2060</button>
</div>
<div class="panel">
    <button style="background: url(0.png)" id="1" onclick="navigate('1')">Town</button>
    <button style="background: url(0.png)" id="2" onclick="navigate('2')">Mountain</button>
    <button style="background: url(0.png)" id="3" onclick="navigate('3')">Sea</button>
</div>
<div class="panel">
    <button style="background: url(0.png)" id="4" onclick="navigate('4')">Desert</button>
    <button style="background: url(0.png)" id="5" onclick="navigate('5')">Swamp</button>
    <button style="background: url(0.png)" id="6" onclick="navigate('6')">&#x2060</button>
</div>
<div class="panel">
    <button style="background: url(0.png)" id="7" onclick="navigate('7')">&#x2060</button>
    <button style="background: url(0.png)" id="8" onclick="navigate('8')">&#x2060</button>
    <button style="background: url(0.png)" id="9" onclick="navigate('9')">&#x2060</button>
</div>
</body>
</html>
<script>

//when logged in and find an animal action=kick out
//when logged out and find an animal action=select animal
//when home back=reload


var url = "https://script.google.com/macros/s/AKfycbz62Jx0ltf7VPmCfnvHHwyyAABqcVJnTVcNqO6Wv68b7mMGQ7_NJTF4P6MPZIbjkMJrWQ/exec"
var locationsHome = ["Town", "Mountain", "Sea", "Desert", "Swamp", "a", "a", "a", "a"]
var locations = [
    ["Tree", "Bush", "Stump", "Nest", "Spider Web", "Creek"],
    ["House", "Street","Lamp","Town Hall", "Store", "Library"],
    ["Summit", "Cave", "Waterfall", "Ravine", "Mine", "Bridge"],
    ["Boat", "Dock", "Beach", "Fish Market", "Surf Shack", "Coral Reef"],
    ["Catus", "Dune", "Tomb", "Canyon", "Oasis", "Tumble Weed"],
    ["Hut", "Outhouse", "Dam", "Mud", "Mangrove", "Stink Hole"]
]
var names = ["CAT", "DOG"]
var avatarLocations = [0,0]
var level = 0
var locationId = [0,0]
var canHide = false
var selected = false
var selectedAvatar = null
var hiding = null

function newAvatar() {
    document.getElementById("phase1").style.display = "none"
    document.getElementById("phase2").style.display = "block"
}

function start() {
    selectedAvatar = document.querySelector('#avatarSelector').selectedIndex - 1
    if (selectedAvatar != -1 && avatarLocations[selectedAvatar] == 0) {
        selected = true
        document.getElementById("avatar").innerHTML = names[selectedAvatar]
        document.getElementById("phase2").style.display = "none"
        document.getElementById("phase3").style.display = "block"
    }
}

function login() {
    document.getElementById("phase1").style.display = "none"
    document.getElementById("phase3").style.display = "block"
}

function navigate(choice) {
    if(level == 0) {
        changeLevel(1, choice)
    } else if(level == 1) {
        checkSpot(choice)
    }
}

function changeLevel(destination, choice) {
    locationId[0] = choice
    for(let i = 1; i <= 9; i++) {
        document.getElementById(i).innerHTML = locations[choice][i]
    }
    level = destination
}

function checkSpot(choice) {
    locationId[1] = choice
    for(let i = 1; i <= 9; i++) {
        document.getElementById(i).innerHTML = "\u2060"
    }
    var isEmpty = true
    for(let i = 0; i < avatarLocations.length; i++) {
        if(avatarLocations[i].toString() == locationString()) {
            document.getElementById(names[i]).innerHTML = names[i]
            isEmpty = false
            hiding = i
        }
    }
    if(isEmpty) {
        document.getElementById(choice).innerHTML = "NOTHING HERE"
    } else {
        document.getElementById(choice).innerHTML = names[hiding] + " FOUND!!"
        if(selectedAvatar == null) {
            document.getElementById("actionButton").innerHTML = "SELECT ANIMAL"
        }
    }
    if(selected) {
        canHide = true
        document.getElementById("actionButton").innerHTML = "HIDE"
    }
    level = 2
}

function action() {
    if(canHide) {
        if(level == 2) {
            write(locationString(), selectedAvatar, "hide")
            document.getElementById("actionButton").innerHTML = "HIDING"
        }
    } else if(selectedAvatar == null){
        write(0, , "find")
        selected = true
        selectedAvatar = hiding
        document.getElementById("avatar").innerHTML = names[hiding]
    }
}

function hidden() {
    document.getElementById("actionButton").innerHTML = "&#x2060"
    document.getElementById("avatar").innerHTML += " (hidden)"
    document.getElementById(locationId[1]).innerHTML = names[selectedAvatar]
}

function found() {
    document.getElementById("actionButton").innerHTML= "&#x2060"
}

function back() {
    if(level == 0) {
        location.reload()
    }
    if(level == 1) {
        for(let i = 0; i < 9; i++) {
            document.getElementById(i+1).innerHTML = locationsHome[i]
            level = 0
        }
    }
    if(level == 2) {
        changeLevel(1, locationId[0])
        hiding = null
    }
}

function onLoad(data) {
    for(let i = 0; i < avatarLocations.length; i++) {
        avatarLocations[i] = data.data[i].Users
        if(avatarLocations[i] == 0) {
            document.getElementById(names[i]).innerHTML = names[i]
        } else {
            document.getElementById(names[i]).innerHTML = "HIDDEN"
        }
    }
}

function read(id) {
    return fetch(url + "?path=Sheet1&action=read")
    .then(res => res.json())
    .then(data => readManager(data, id))
}

function write(location, id, action) {
    fetch(url + "?path=Sheet1&action=update&Users=" + location + "&number=" + (id + 2))
    .then(res => readManager(res, action))
}

function readManager(data, id) {
    switch(id) {
        case "onLoad":
            onLoad(data)
            break
        case "hide":
            hidden()
            break
        case "find":
            found()
            break
    }
}

function locationString() {
    return locationId[0].toString() + locationId[1].toString()
}

</script>
<style>
    button, select {
        height: 128px;
        width: 128px;
        border: none;
    }
    .panel {
        height: 128px;
        width: 384px;
        font-size: 0px;
    }
    #phase2, #phase3 {
        display: none;
    }
</style>