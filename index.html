<!DOCTYPE html>
<html>
<body onload="onLoad()">
    <h1>welcome to the room</h1>
    <form>
        <select id="input1">
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="G">G</option>
            <option value="H">H</option>
            <option value="I">I</option>
            <option value="J">J</option>
            <option value="K">K</option>
            <option value="L">L</option>
            <option value="M">M</option>
            <option value="N">N</option>
            <option value="O">O</option>
            <option value="P">P</option>
            <option value="Q">Q</option>
            <option value="R">R</option>
            <option value="S">S</option>
            <option value="T">T</option>
            <option value="U">U</option>
            <option value="V">V</option>
            <option value="W">W</option>
            <option value="X">X</option>
            <option value="Y">Y</option>
            <option value="Z">Z</option>
        </select>
        <select id="input2">
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="G">G</option>
            <option value="H">H</option>
            <option value="I">I</option>
            <option value="J">J</option>
            <option value="K">K</option>
            <option value="L">L</option>
            <option value="M">M</option>
            <option value="N">N</option>
            <option value="O">O</option>
            <option value="P">P</option>
            <option value="Q">Q</option>
            <option value="R">R</option>
            <option value="S">S</option>
            <option value="T">T</option>
            <option value="U">U</option>
            <option value="V">V</option>
            <option value="W">W</option>
            <option value="X">X</option>
            <option value="Y">Y</option>
            <option value="Z">Z</option>
        </select>
        <select id="input3">
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="G">G</option>
            <option value="H">H</option>
            <option value="I">I</option>
            <option value="J">J</option>
            <option value="K">K</option>
            <option value="L">L</option>
            <option value="M">M</option>
            <option value="N">N</option>
            <option value="O">O</option>
            <option value="P">P</option>
            <option value="Q">Q</option>
            <option value="R">R</option>
            <option value="S">S</option>
            <option value="T">T</option>
            <option value="U">U</option>
            <option value="V">V</option>
            <option value="W">W</option>
            <option value="X">X</option>
            <option value="Y">Y</option>
            <option value="Z">Z</option>
        </select>
    </form>
    <button onclick="createChar()">create</button>
    <div class="container">
        <img src="smiley.png">
        <h2 id="0"></h2>
        <button id="plus" onclick="update('0', true)">+</button><button id="minus" onclick="update('0', false)">-</button>
    </div>
    <div class="container">
        <img src="smiley.png">
        <h2 id="1"></h2>
        <button id="plus" onclick="update('1', true)">+</button><button id="minus" onclick="update('1', false)">-</button>
    </div>
    <div class="container">
        <img src="smiley.png">
        <h2 id="2"></h2>
        <button id="plus" onclick="update('2', true)">+</button><button id="minus" onclick="update('2', false)">-</button>
    </div>
    <div class="container">
        <img src="smiley.png">
        <h2 id="3"></h2>
        <button id="plus" onclick="update('3', true)">+</button><button id="minus" onclick="update('3', false)">-</button>
    </div>
    <div class="container">
        <img src="smiley.png">
        <h2 id="4"></h2>
        <button id="plus" onclick="update('4', true)">+</button><button id="minus" onclick="update('4', false)">-</button>
    </div>
    <div class="container">
        <img src="smiley.png">
        <h2 id="5"></h2>
        <button id="plus" onclick="update('5', true)">+</button><button id="minus" onclick="update('5', false)">-</button>
    </div>
    <div class="container">
        <img src="smiley.png">
        <h2 id="6"></h2>
        <button id="plus" onclick="update('6', true)">+</button><button id="minus" onclick="update('6', false)">-</button>
    </div>
    <div class="container">
        <img src="smiley.png">
        <h2 id="7"></h2>
        <button id="plus" onclick="update('7', true)">+</button><button id="minus" onclick="update('7', false)">-</button>
    </div>
    <div class="container">
        <img src="smiley.png">
        <h2 id="8"></h2>
        <button id="plus" onclick="update('8', true)">+</button><button id="minus" onclick="update('8', false)">-</button>
    </div>
</body>
</html>
<script>
var awaiting = false
var url = "https://script.google.com/macros/s/AKfycbx01WayjWlnC3uo5NrUUXI-Pk7k71Oe7ovdwzClJIRKjN3UsyDrv1gAfXhtmqwSaLoNXA/exec"
function onLoad() {
    awaiting = true
    fetch(url + "?path=Sheet3&action=read")
    .then(res => res.json())
    .then(data => onLoad2(data))
    fetch(url + "?path=Sheet2&action=read")
    .then(res => res.json())
    .then(data => onLoad2(data))
}
function onLoad2(dbData) {
    for(let i = 0; i < dbData.data.length; i++) {
        let div = document.createElement("test")
        div.innerHTML = dbData.data[i].Users
        document.getElementById(i).appendChild(div)
    }
    awaiting = false
}
function createChar() {
    if(!awaiting) {
        awaiting = true
        fetch(url + "?path=Sheet3&action=read")
        .then(res => res.json())
        .then(data => comment2(data))
    }
}
function comment2(dbData) {
    if(dbData.data.length >= 9) {
        console.log("limit reached")
    } else {
        var name = document.getElementById("input1").value + document.getElementById("input2").value + document.getElementById("input3").value
        fetch(url + "?path=Sheet3&action=write&Users=" + name)
        fetch(url + "?path=Sheet2&action=write&Users=1")
        let div1 = document.createElement("test")
        div1.innerHTML = name
        document.getElementById(dbData.data.length).appendChild(div1)
        let div2 = document.createElement("test")
        div2.innerHTML = 1
        document.getElementById(dbData.data.length).appendChild(div2)
    }
    awaiting = false
}
function comment3(dbData) { // usesless?
    let div = document.createElement("test")
    div.innerHTML = dbData.data[dbData.data.length - 1].Users
    document.getElementById(dbData.data.length).appendChild(div)
}
function update(id, positive) {
    if(!awaiting) {
        awaiting = true
        fetch(url + "?path=Sheet2&action=read")
        .then(res => res.json())
        .then(data => update2(data, id, positive))
    }
}
function update2(dbData, id, positive) {
    var newValue = dbData.data[id].Users
    positive ? newValue++ : newValue--
    id++
    id++
    if(newValue > 0) {
        fetch(url + "?path=Sheet2&action=update&Users=" + newValue + "&number=" + id)
        reset()
        fetch(url + "?path=Sheet2&action=read")
        .then(res => res.json())
        .then(data => onLoad2(data))
        fetch(url + "?path=Sheet3&action=read")
        .then(res => res.json())
        .then(data => onLoad2(data))
    } else {
        fetch(url + "?path=Sheet2&action=remove&number=" + id)
        fetch(url + "?path=Sheet3&action=remove&number=" + id)
        document.getElementById(id - 2).innerHTML = ""
    }
    awating = false
}
function reset() {
    for(let i = 0; i < 9; i++) {
        document.getElementById(i).innerHTML = ""
    }
}
</script>
<style>
    .container {
    position: relative;
    width: 100%;
    max-width: 200px;
    margin: auto;
    }

    .container img {
    width: 100%;
    height: auto;
    }

    .container button {
        top: 90%;
        position: absolute;
        transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
    }

    .container #minus {
        left: 70%;
    }

    .container #plus {
        left: 30%;
    }

    .container h2 {
        top: 70%;
        left: 50%;
        position: absolute;
        transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
    }
</style>